void handleConditionBubbles() {
  digimonState = load(0x134C5B)
  bubbleType = -1
  
  // normal or training
  if(digimonState != 1 && digimonState != 10)
    return
  
  conditionFlag = load(0x138460)
  activeBubble = load(0x134C6C)
  
  if(conditionFlag & 0x40 != 0 && activeBubble != 2)
    bubbleType = 2
  if(conditionFlag & 0x20 != 0 && activeBubble != 6)
    bubbleType = 6
  if(conditionFlag & 0x08 != 0 && activeBubble != 1)
    bubbleType = 1
  if(conditionFlag & 0x04 != 0 && activeBubble != 0)
    bubbleType = 0
  if(conditionFlag & 0x02 != 0 && activeBubble != 4)
    bubbleType = 4
  if(conditionFlag & 0x01 != 0 && activeBubble != 3)
    bubbleType = 3
  
  if(conditionFlag & 0x10 != 0 && bubbleType == -1 && load(0x134C54) != 0 && conditionFlag == 0x10) {
    unsetBubble(load(0x134C70))
    
    store(0x134C60, setButterfly(load(0x12F348)))
    store(0x134C54, 0)
    return
  }
  
  activeBubble = load(0x134C6C)
  
  // new bubble, old bubble ran out
  if(bubbleType != activeBubble && bubbleType != -1 && load(0x134C74) >= 50 && load(0x134C54) == 0) {
    unsetButterfly(load(0x134C60))
    
    store(0x134C54, 0)
    store(0x138460, load(0x138460) & 0xFFEF) // remove butterfly
    store(0x1557D7, 1)
    
    unsetBubble(load(0x134C70))
    
    store(0x134C6C, bubbleType)
    store(0x134C70, setBubble(bubbleType, load(0x12F348)))
    store(0x134C74, 0)
  }
  
  newFrameCount = load(0x134C74) + 1
  store(0x134C74, newFrameCount >= 60 ? -1 : newFrameCount)
}

0x000a7960 addiu r29,r29,0xffe8
0x000a7964 sw r31,0x0014(r29)
0x000a7968 lb r2,-0x6ed1(r28)
0x000a796c sw r16,0x0010(r29)
0x000a7970 addiu r16,r0,0xffff
0x000a7974 addiu r1,r0,0x0001
0x000a7978 beq r2,r1,0x000a798c
0x000a797c addu r3,r2,r0
0x000a7980 addiu r1,r0,0x000a
0x000a7984 bne r3,r1,0x000a7b84
0x000a7988 nop
0x000a798c lui r1,0x8014
0x000a7990 lw r3,-0x7ba0(r1)
0x000a7994 nop
0x000a7998 addu r2,r3,r0
0x000a799c andi r2,r2,0x0040
0x000a79a0 beq r2,r0,0x000a79bc
0x000a79a4 nop
0x000a79a8 lw r2,-0x6ec0(r28)
0x000a79ac addiu r1,r0,0x0002
0x000a79b0 beq r2,r1,0x000a79bc
0x000a79b4 nop
0x000a79b8 addiu r16,r0,0x0002
0x000a79bc andi r2,r3,0x0020
0x000a79c0 beq r2,r0,0x000a79dc
0x000a79c4 nop
0x000a79c8 lw r2,-0x6ec0(r28)
0x000a79cc addiu r1,r0,0x0006
0x000a79d0 beq r2,r1,0x000a79dc
0x000a79d4 nop
0x000a79d8 addiu r16,r0,0x0006
0x000a79dc andi r2,r3,0x0008
0x000a79e0 beq r2,r0,0x000a79fc
0x000a79e4 nop
0x000a79e8 lw r2,-0x6ec0(r28)
0x000a79ec addiu r1,r0,0x0001
0x000a79f0 beq r2,r1,0x000a79fc
0x000a79f4 nop
0x000a79f8 addiu r16,r0,0x0001
0x000a79fc andi r2,r3,0x0004
0x000a7a00 beq r2,r0,0x000a7a1c
0x000a7a04 nop
0x000a7a08 lw r2,-0x6ec0(r28)
0x000a7a0c nop
0x000a7a10 beq r2,r0,0x000a7a1c
0x000a7a14 nop
0x000a7a18 addu r16,r0,r0
0x000a7a1c andi r2,r3,0x0002
0x000a7a20 beq r2,r0,0x000a7a3c
0x000a7a24 nop
0x000a7a28 lw r2,-0x6ec0(r28)
0x000a7a2c addiu r1,r0,0x0004
0x000a7a30 beq r2,r1,0x000a7a3c
0x000a7a34 nop
0x000a7a38 addiu r16,r0,0x0004
0x000a7a3c andi r2,r3,0x0001
0x000a7a40 beq r2,r0,0x000a7a5c
0x000a7a44 nop
0x000a7a48 lw r2,-0x6ec0(r28)
0x000a7a4c addiu r1,r0,0x0003
0x000a7a50 beq r2,r1,0x000a7a5c
0x000a7a54 nop
0x000a7a58 addiu r16,r0,0x0003
0x000a7a5c andi r2,r3,0x0010
0x000a7a60 beq r2,r0,0x000a7ab8
0x000a7a64 nop
0x000a7a68 addiu r1,r0,0xffff
0x000a7a6c bne r16,r1,0x000a7ab8
0x000a7a70 nop
0x000a7a74 lw r2,-0x6ed8(r28)
0x000a7a78 nop
0x000a7a7c beq r2,r0,0x000a7ab8
0x000a7a80 nop
0x000a7a84 addiu r1,r0,0x0010
0x000a7a88 bne r3,r1,0x000a7ab8
0x000a7a8c nop
0x000a7a90 lw r4,-0x6ebc(r28)
0x000a7a94 jal 0x000ece20
0x000a7a98 nop
0x000a7a9c lui r1,0x8013
0x000a7aa0 lw r4,-0x0cb8(r1)
0x000a7aa4 jal 0x000e9d24
0x000a7aa8 nop
0x000a7aac sw r2,-0x6ecc(r28)
0x000a7ab0 beq r0,r0,0x000a7b84
0x000a7ab4 sw r0,-0x6ed8(r28)
0x000a7ab8 lw r2,-0x6ec0(r28)
0x000a7abc nop
0x000a7ac0 beq r16,r2,0x000a7b58
0x000a7ac4 nop
0x000a7ac8 addiu r1,r0,0xffff
0x000a7acc beq r16,r1,0x000a7b58
0x000a7ad0 nop
0x000a7ad4 lw r2,-0x6eb8(r28)
0x000a7ad8 nop
0x000a7adc slti r1,r2,0x0032
0x000a7ae0 bne r1,r0,0x000a7b58
0x000a7ae4 nop
0x000a7ae8 lw r2,-0x6ed8(r28)
0x000a7aec nop
0x000a7af0 bne r2,r0,0x000a7b30
0x000a7af4 nop
0x000a7af8 lw r4,-0x6ecc(r28)
0x000a7afc jal 0x000e9fb4
0x000a7b00 nop
0x000a7b04 addiu r2,r0,0xffff
0x000a7b08 lui r1,0x8014
0x000a7b0c sw r2,-0x6ed8(r28)
0x000a7b10 lw r3,-0x7ba0(r1)
0x000a7b14 addiu r2,r0,0xffef
0x000a7b18 and r2,r3,r2
0x000a7b1c lui r1,0x8014
0x000a7b20 sw r2,-0x7ba0(r1)
0x000a7b24 addiu r2,r0,0x0001
0x000a7b28 lui r1,0x8015
0x000a7b2c sb r2,0x57d7(r1)
0x000a7b30 lw r4,-0x6ebc(r28)
0x000a7b34 jal 0x000ece20
0x000a7b38 nop
0x000a7b3c lui r1,0x8013
0x000a7b40 lw r5,-0x0cb8(r1)
0x000a7b44 jal 0x000ec538
0x000a7b48 addu r4,r16,r0
0x000a7b4c sw r2,-0x6ebc(r28)
0x000a7b50 sw r0,-0x6eb8(r28)
0x000a7b54 sw r16,-0x6ec0(r28)
0x000a7b58 lw r2,-0x6eb8(r28)
0x000a7b5c nop
0x000a7b60 addi r2,r2,0x0001
0x000a7b64 sw r2,-0x6eb8(r28)
0x000a7b68 lw r2,-0x6eb8(r28)
0x000a7b6c nop
0x000a7b70 slti r1,r2,0x003c
0x000a7b74 bne r1,r0,0x000a7b84
0x000a7b78 nop
0x000a7b7c addiu r2,r0,0xffff
0x000a7b80 sw r2,-0x6ec0(r28)
0x000a7b84 lw r31,0x0014(r29)
0x000a7b88 lw r16,0x0010(r29)
0x000a7b8c jr r31
0x000a7b90 addiu r29,r29,0x0018